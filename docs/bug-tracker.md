# AirSim Studio Bug è¿½è¸ª

> ç»Ÿä¸€çš„ Bug ä¸ UI äº¤äº’é—®é¢˜è¿½è¸ªæ–‡æ¡£
> æœ€åæ›´æ–°: 2026-02-18

---

## æ ¼å¼è¯´æ˜

- **çŠ¶æ€**: ğŸŸ¢ Fixed / ğŸ”´ Open
- **ä¸¥é‡åº¦**: Critical / High / Medium / Low
- **ç¼–å·**: BUG-XXXï¼ˆå·²ä¿®å¤å†å²ï¼‰æˆ– ä¸¥é‡åº¦å‰ç¼€-ç¼–å·ï¼ˆå¾…ä¿®å¤é—®é¢˜ï¼‰

---

## ç»Ÿè®¡

| ä¸¥é‡åº¦ | å¾…ä¿®å¤ | å·²ä¿®å¤ | åˆè®¡ |
|--------|--------|--------|------|
| Critical | 0 | 7 | 7 |
| High | 0 | 12 | 12 |
| Medium | 1 | 20 | 21 |
| Low | 0 | 29 | 29 |
| **åˆè®¡** | **1** | **68** | **69** |

---

## ä¸€ã€å·²ä¿®å¤

### BUG-001: æš—è‰²æ¨¡å¼ä¸‹å¤šç»„ä»¶é¢œè‰²ç¡¬ç¼–ç  ğŸŸ¢
- **æ—¥æœŸ**: 2026-02-15
- **ä¸¥é‡åº¦**: Medium
- **èŒƒå›´**: å‰ç«¯

**é—®é¢˜**: ScheduleEditorã€ContaminantPanelã€PropertyPanelã€ZonePropertiesã€ModelSummaryã€AHSPanel ä¸­å¤§é‡ä½¿ç”¨ `#000000`ã€`#FFFFFF`ã€`text-slate-*`ã€`bg-white` ç­‰ç¡¬ç¼–ç é¢œè‰²ï¼Œæš—è‰²æ¨¡å¼ä¸‹æ–‡å­—ä¸å¯è§ã€‚

**æ ¹å› **: ç»„ä»¶å¼€å‘æ—¶æœªä½¿ç”¨ Tailwind ä¸»é¢˜å˜é‡ï¼Œç›´æ¥å†™æ­»äº†äº®è‰²æ¨¡å¼é¢œè‰²å€¼ã€‚

**ä¿®å¤**: å…¨éƒ¨æ›¿æ¢ä¸º theme-aware çš„ Tailwind ç±»: `text-foreground`ã€`bg-background`ã€`bg-card`ã€`border-border`ã€`bg-accent`ã€‚

**æ¶‰åŠæ–‡ä»¶**:
- `app/src/components/ScheduleEditor/ScheduleEditor.tsx` â€” 13 å¤„é¢œè‰²æ›¿æ¢
- `app/src/components/ContaminantPanel/ContaminantPanel.tsx` â€” 11 å¤„é¢œè‰²æ›¿æ¢ + å•ä½æ ‡ç­¾
- `app/src/components/PropertyPanel/PropertyPanel.tsx` â€” 6 å¤„é¢œè‰²æ›¿æ¢
- `app/src/components/PropertyPanel/ZoneProperties.tsx` â€” 1 å¤„å•ä½æ ‡ç­¾é¢œè‰²
- `app/src/components/ModelSummary/ModelSummary.tsx` â€” 8 å¤„é¢œè‰²æ›¿æ¢
- `app/src/components/AHSPanel/AHSPanel.tsx` â€” 5 å¤„é¢œè‰²æ›¿æ¢

**éªŒè¯**:
- [x] TypeScript ç¼–è¯‘é€šè¿‡
- [x] æš—è‰²/äº®è‰²æ¨¡å¼æ‰‹åŠ¨åˆ‡æ¢éªŒè¯

---

### BUG-002: PropertyPanel æ ‡ç­¾é¡µæ‹¥æŒ¤ä¸å¯è¯» ğŸŸ¢
- **æ—¥æœŸ**: 2026-02-15
- **ä¸¥é‡åº¦**: Medium
- **èŒƒå›´**: å‰ç«¯

**é—®é¢˜**: PropertyPanel 7 ä¸ªæ ‡ç­¾é¡µæŒ¤åœ¨å›ºå®š `h-8` çš„å•è¡Œä¸­ï¼Œæ–‡å­—è¢«æˆªæ–­ï¼Œç‚¹å‡»å›°éš¾ã€‚ä¾§è¾¹æ é¡¶éƒ¨è¢« TopBar é®æŒ¡ã€‚

**æ ¹å› **: æ ‡ç­¾å®¹å™¨ä½¿ç”¨å›ºå®šé«˜åº¦ä¸”æ— æ¢è¡Œï¼Œæ ‡ç­¾å†…è¾¹è·è¿‡å° (`px-1`)ã€‚

**ä¿®å¤**: æ ‡ç­¾å®¹å™¨æ”¹ä¸º `flex-wrap gap-1`ï¼Œæ ‡ç­¾å†…è¾¹è·å¢åŠ åˆ° `px-2.5 py-1`ï¼Œä¾§è¾¹æ æ·»åŠ  `pt-12`ã€‚

**æ¶‰åŠæ–‡ä»¶**:
- `app/src/components/PropertyPanel/PropertyPanel.tsx` â€” æ ‡ç­¾å¸ƒå±€é‡æ„

**éªŒè¯**:
- [x] TypeScript ç¼–è¯‘é€šè¿‡
- [x] 7 ä¸ªæ ‡ç­¾é¡µå‡å¯æ­£å¸¸æ˜¾ç¤ºå’Œç‚¹å‡»

---

### BUG-003: å¤šç»„ä»¶ story ç©ºå¼•ç”¨å´©æºƒ ğŸŸ¢
- **æ—¥æœŸ**: 2026-02-15
- **ä¸¥é‡åº¦**: Critical
- **èŒƒå›´**: å‰ç«¯

**é—®é¢˜**: FloatingStatusBoxã€ZonePropertiesã€EdgePropertiesã€PlacementPropertiesã€StoryProperties ç›´æ¥è®¿é—® `story.geometry` è€Œä¸æ£€æŸ¥ `story` æ˜¯å¦ä¸º null/undefinedã€‚`getActiveStory()` è¿”å› undefined æ—¶é¡µé¢ç™½å±å´©æºƒã€‚

**æ ¹å› **: `getActiveStory()` å¯èƒ½è¿”å› undefinedï¼Œè°ƒç”¨æ–¹æœªåšç©ºå€¼å®ˆå«ã€‚

**ä¿®å¤**: æ‰€æœ‰è®¿é—® `story.geometry` ä¹‹å‰æ·»åŠ  `if (!story) return null;` å®ˆå«ã€‚

**æ¶‰åŠæ–‡ä»¶**:
- `app/src/canvas/components/FloatingStatusBox.tsx` â€” 2 å¤„ null guard + `story?.geometry` å¯é€‰é“¾
- `app/src/components/PropertyPanel/ZoneProperties.tsx` â€” 4 å¤„ null guard (ZoneProperties, EdgeProperties, PlacementProperties, StoryProperties å„ 1 å¤„)

**éªŒè¯**:
- [x] 25 ä¸ª Vitest æµ‹è¯•é€šè¿‡
- [x] TypeScript ç¼–è¯‘é€šè¿‡

---

### BUG-004: ResultsView åº•éƒ¨é¢æ¿æº¢å‡ºç”»å¸ƒ ğŸŸ¢
- **æ—¥æœŸ**: 2026-02-15
- **ä¸¥é‡åº¦**: Low
- **èŒƒå›´**: å‰ç«¯

**é—®é¢˜**: BottomPanel åœ¨å®½å±ä¸‹æ— å®½åº¦é™åˆ¶ï¼Œç»“æœæ ‡ç­¾æ–‡å­—æº¢å‡ºå®¹å™¨è¾¹ç•Œã€‚

**æ ¹å› **: BottomPanel ä½¿ç”¨å›ºå®šå±…ä¸­å®šä½ï¼Œæ—  max-width çº¦æŸï¼Œæ ‡ç­¾æ–‡å­—æ—  overflow å¤„ç†ã€‚

**ä¿®å¤**: BottomPanel æ”¹ä¸º `left-3 right-3 max-w-[900px] mx-auto` å“åº”å¼å¸ƒå±€ï¼Œç»“æœæ ‡ç­¾æ·»åŠ  `overflow-hidden text-ellipsis`ã€‚

**æ¶‰åŠæ–‡ä»¶**:
- `app/src/App.tsx` â€” BottomPanel å®¹å™¨æ ·å¼

**éªŒè¯**:
- [x] TypeScript ç¼–è¯‘é€šè¿‡

---

## äºŒã€å¾…ä¿®å¤ â€” Critical (0, å…¨éƒ¨å·²ä¿®å¤)

### C-01 dataBridge ä¸¢å¼ƒæ‰€æœ‰ç”¨æˆ·é…ç½®çš„æ„ä»¶å‚æ•° ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:116-120`
- **ç°è±¡**: `canvasToTopology()` å§‹ç»ˆè°ƒç”¨ `PLACEMENT_TO_ELEMENT` å·¥å‚å‡½æ•°è¿”å›ç¡¬ç¼–ç é»˜è®¤å€¼ï¼Œä»ä¸è¯»å– `placement.flowCoefficient`ã€`flowExponent`ã€`dischargeCd`ã€`openingArea` ç­‰ç”¨æˆ·åœ¨å±æ€§é¢æ¿ä¸­é…ç½®çš„å‚æ•°
- **å½±å“**: ç”¨æˆ·åœ¨å±æ€§é¢æ¿ç²¾å¿ƒé…ç½®çš„æ‰€æœ‰æµé‡å‚æ•°è¢«é™é»˜ä¸¢å¼ƒï¼Œå¼•æ“å§‹ç»ˆæ”¶åˆ°é»˜è®¤å€¼ã€‚`isConfigured` æ ‡è®°å˜ç»¿ç»™ç”¨æˆ·è™šå‡ä¿¡å¿ƒ
- **ä¿®å¤å»ºè®®**: å½“ `placement.isConfigured === true` æ—¶ï¼Œä» placement å­—æ®µæ„å»º element å¯¹è±¡ï¼Œå¦åˆ™å›é€€åˆ°å·¥å‚é»˜è®¤å€¼

### C-02 é—¨çš„æµé‡æ¨¡å‹ UI ä¸å¼•æ“ä¸åŒ¹é… ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:15` vs `app/src/components/PropertyPanel/ZoneProperties.tsx:297-317`
- **ç°è±¡**: dataBridge å°† `door` æ˜ å°„ä¸º `TwoWayFlow`ï¼ˆå‚æ•°: Cd, area, heightï¼‰ï¼Œä½†å±æ€§é¢æ¿æ˜¾ç¤ºçš„æ˜¯ `flowCoefficient (C)` å’Œ `flowExponent (n)`ï¼ˆPowerLaw å‚æ•°ï¼‰ã€‚UI å’Œå¼•æ“ä½¿ç”¨å®Œå…¨ä¸åŒçš„æµé‡å…ƒä»¶æ¨¡å‹
- **ä¿®å¤å»ºè®®**: ç»Ÿä¸€â€”â€”è¦ä¹ˆé¢æ¿æ”¹ä¸ºæ˜¾ç¤º Cd/area/heightï¼Œè¦ä¹ˆ dataBridge æ”¹ä¸ºæ˜ å°„åˆ° PowerLawOrifice

### C-03 å¤šæ¥¼å±‚æ¨¡å‹æ— å‚ç›´è¿é€š ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:66-142`
- **ç°è±¡**: `canvasToTopology()` é€æ¥¼å±‚ç‹¬ç«‹å¤„ç†ï¼Œä»ä¸ç”Ÿæˆè·¨æ¥¼å±‚ Linkã€‚å¤šæ¥¼å±‚å»ºç­‘çš„æ¯å±‚æ˜¯å®Œå…¨éš”ç¦»çš„æ°”æµç½‘ç»œï¼ŒçƒŸå›±æ•ˆåº”ã€æ¥¼æ¢¯é—´æ°”æµç­‰æ— æ³•æ¨¡æ‹Ÿ
- **ç›¸å…³**: `ZoneAssignment`ï¼ˆ`geometry.ts:90-97`ï¼‰æ—  `isShaft` å­—æ®µ
- **ä¿®å¤å»ºè®®**: è®¾è®¡å‚ç›´è¿é€šæ¨¡å‹ï¼ˆæ–¹æ¡ˆ A: ZoneAssignment åŠ  shaftGroupIdï¼›æ–¹æ¡ˆ B: æ–°å¢ InterStoryLink æ•°ç»„ï¼‰

### C-04 opening ç±»å‹æ˜ å°„é”™è¯¯ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:17`
- **ç°è±¡**: `opening` æ˜ å°„åˆ° `PowerLawOrifice`ï¼ˆC, nï¼‰ï¼Œä½† PlacementProperties ä¸º opening é…ç½®çš„æ˜¯ `dischargeCd` å’Œ `openingArea`ï¼ˆTwoWayFlow å‚æ•°ï¼‰
- **ä¿®å¤å»ºè®®**: opening åº”æ˜ å°„åˆ° TwoWayFlowï¼Œæˆ– UI æ”¹ä¸ºé…ç½® C/n

### C-05 æµè§ˆå™¨æ¨¡å¼ä½¿ç”¨éšæœºå‡æ•°æ®ä¸”æ— ä»»ä½•æç¤º ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/TopBar/TopBar.tsx:66-97`
- **ç°è±¡**: é Tauri ç¯å¢ƒä¸‹ `handleRun()` ç”¨ `Math.random()` ç”Ÿæˆå®Œå…¨è™šå‡çš„ä»¿çœŸç»“æœï¼Œæ— ä»»ä½• UI æç¤ºå‘ŠçŸ¥ç”¨æˆ·æ•°æ®æ˜¯æ¨¡æ‹Ÿçš„
- **å½±å“**: ç”¨æˆ·å¯èƒ½è¯¯ä¿¡ä»¿çœŸç»“æœåšå‡ºé”™è¯¯å†³ç­–
- **ä¿®å¤å»ºè®®**: æ–¹æ¡ˆ A: æµè§ˆå™¨æ¨¡å¼ç¦ç”¨è¿è¡ŒæŒ‰é’®å¹¶æç¤ºéœ€è¦æ¡Œé¢ç‰ˆï¼›æ–¹æ¡ˆ B: ç»“æœé¢æ¿é¡¶éƒ¨æ·»åŠ é†’ç›®çš„"æ¨¡æ‹Ÿæ•°æ®"è­¦å‘Šæ¨ªå¹…

### C-06 å¼•æ“ä¸´æ—¶æ–‡ä»¶ç«æ€æ¡ä»¶ ğŸŸ¢
- **æ–‡ä»¶**: `app/src-tauri/src/lib.rs` (run_engine / find_engine_path)
- **ç°è±¡**: ä½¿ç”¨å›ºå®šæ–‡ä»¶å `contam_input.json` / `contam_output.json` å†™å…¥ç³»ç»Ÿä¸´æ—¶ç›®å½•ã€‚å¹¶å‘è¿è¡Œä¸¤æ¬¡ä»¿çœŸä¼šäº’ç›¸è¦†ç›–è¾“å…¥è¾“å‡ºæ–‡ä»¶
- **å½±å“**: å¤šæ¬¡å¿«é€Ÿç‚¹å‡»è¿è¡Œæˆ–æœªæ¥æ”¯æŒæ‰¹é‡è¿è¡Œæ—¶ç»“æœé”™ä¹±
- **ä¿®å¤å»ºè®®**: ä½¿ç”¨ `tempfile::NamedTempFile` æˆ– UUID ç”Ÿæˆå”¯ä¸€ä¸´æ—¶æ–‡ä»¶å

---

## ä¸‰ã€å¾…ä¿®å¤ â€” High (0, å…¨éƒ¨å·²ä¿®å¤)

### H-01 å¢™ä½“ç»˜åˆ¶æ— é“¾å¼ç»­ç”» ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:489-492`, `app/src/store/useCanvasStore.ts:305-308`
- **ç°è±¡**: ç¡®è®¤ä¸€æ®µå¢™å wallPreview å®Œå…¨é‡ç½®ï¼Œç”¨æˆ·å¿…é¡»é‡æ–°ç‚¹å‡»å¼€å§‹ä¸‹ä¸€æ®µ
- **å½±å“**: ç»˜åˆ¶å¤šæ®µå¢™ä½“å›´åˆæˆ¿é—´æ—¶æ‘©æ“¦æå¤§ï¼Œæ¯æ®µå¢™éœ€è¦ä¸¤æ¬¡ç‚¹å‡»ï¼ˆèµ·ç‚¹+ç»ˆç‚¹ï¼‰ï¼Œè€Œéè¿ç»­ç‚¹å‡»
- **å¯¹æ¯”**: æ‰€æœ‰ CAD å·¥å…·ï¼ˆSketchUpã€Floorspace.jsã€AutoCADï¼‰éƒ½ä¼šè‡ªåŠ¨å°†ä¸Šä¸€æ®µç»ˆç‚¹ä½œä¸ºä¸‹ä¸€æ®µèµ·ç‚¹
- **ä¿®å¤å»ºè®®**: `confirmWall()` åå°† `wallPreview.end` èµ‹ç»™æ–°çš„ `wallPreview.start`ï¼Œè€Œéæ¸…ç©º

### H-02 é—¨çª—æ”¾ç½®æ— æ‚¬åœé¢„è§ˆ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:529-537, 604-617`
- **ç°è±¡**: door/window å·¥å…·æ¨¡å¼ä¸‹æ— ä»»ä½•è§†è§‰åé¦ˆâ€”â€”ä¸é«˜äº®ç›®æ ‡å¢™ä½“ã€ä¸æ˜¾ç¤ºæ”¾ç½®é¢„è§ˆã€ä¸æ˜¾ç¤º alpha ä½ç½®
- **å¯¹æ¯”**: wall å·¥å…·æœ‰è™šçº¿é¢„è§ˆï¼Œrect å·¥å…·æœ‰çŸ©å½¢é¢„è§ˆï¼Œå”¯ç‹¬é—¨çª—æ²¡æœ‰ä»»ä½•è§†è§‰æç¤º
- **ä¿®å¤å»ºè®®**: mousemove æ—¶åš hitTest æ‰¾æœ€è¿‘ edgeï¼Œæ¸²æŸ“åŠé€æ˜é—¨çª—å›¾æ ‡åœ¨ alpha ä½ç½®

### H-03 é—¨çª—æ”¾ç½®åæ— æ³•æ‹–åŠ¨è°ƒæ•´ä½ç½® ğŸŸ¢
- **æ–‡ä»¶**: å…¨å±€æœç´¢ `drag.*placement` é›¶ç»“æœ
- **ç°è±¡**: æ”¾ç½®åå”¯ä¸€è°ƒæ•´æ–¹å¼æ˜¯åˆ é™¤é‡æ”¾ã€‚å±æ€§é¢æ¿ä¸­ alpha å€¼ä¸ºåªè¯»æ–‡æœ¬ï¼ˆ`ZoneProperties.tsx:243`ï¼‰ï¼Œæ— æ»‘å—æˆ–è¾“å…¥æ¡†
- **ä¿®å¤å»ºè®®**: æ–¹æ¡ˆ A: æ·»åŠ  canvas æ‹–æ‹½ï¼ˆselect æ¨¡å¼ä¸‹æ‹–åŠ¨ placement æ²¿ edge æ»‘åŠ¨ï¼‰ï¼›æ–¹æ¡ˆ B: å±æ€§é¢æ¿ alpha æ”¹ä¸ºå¯ç¼–è¾‘æ»‘å—

### H-04 æ“¦é™¤å·¥å…·æ— åˆ é™¤é¢„è§ˆ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:540-548`
- **ç°è±¡**: æ“¦é™¤å·¥å…·ç‚¹å‡»å³åˆ é™¤ï¼Œæ— æ‚¬åœé«˜äº®ã€æ— ç¡®è®¤å¯¹è¯æ¡†ã€‚å…‰æ ‡æ˜¾ç¤º `not-allowed`ï¼ˆè¯­ä¹‰é”™è¯¯ï¼Œåº”ä¸ºæ“¦é™¤å›¾æ ‡ï¼‰ã€‚åˆ é™¤å¢™ä½“æ—¶çº§è”åˆ é™¤å…¶ä¸Šæ‰€æœ‰é—¨çª—ï¼ˆ`useCanvasStore.ts:351-376`ï¼‰ï¼Œæ— ä»»ä½•è­¦å‘Šæç¤º
- **ä¿®å¤å»ºè®®**: æ‚¬åœæ—¶é«˜äº®ç›®æ ‡ä¸ºçº¢è‰²ï¼Œç‚¹å‡»åæ˜¾ç¤ºç¡®è®¤ï¼ˆå°¤å…¶æ˜¯çº§è”åˆ é™¤æ—¶ï¼‰

### H-05 çŸ©å½¢å·¥å…·éœ€è¦ 4 æ¬¡ Ctrl+Z æ‰èƒ½æ’¤é”€ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:517-521`
- **ç°è±¡**: çŸ©å½¢ç”± 4 æ¬¡ç‹¬ç«‹ `addWall` è°ƒç”¨åˆ›å»ºï¼Œäº§ç”Ÿ 4 ä¸ª undo æ­¥éª¤ã€‚æ¯æ¬¡è°ƒç”¨éƒ½è§¦å‘ `structuredClone` + `rebuildFaces`ï¼Œæ€§èƒ½æµªè´¹
- **ä¿®å¤å»ºè®®**: æ·»åŠ  batch/atomic æ“ä½œï¼ˆzundo çš„ `temporal.pause()`/`temporal.resume()`ï¼‰ï¼Œä¸€æ¬¡æ€§æ·»åŠ  4 é¢å¢™ä½œä¸ºå•ä¸ª undo æ­¥éª¤

### H-06 æ¥¼å±‚ç®¡ç†ç¼ºå°‘åŸºæœ¬ CRUD ğŸŸ¢
- **æ–‡ä»¶**: `app/src/store/useCanvasStore.ts:106-108`
- **ç°è±¡**: åªæœ‰ `addStory`ã€`setActiveStory`ã€`updateStoryHeight` ä¸‰ä¸ª actionã€‚ç¼ºå°‘ï¼šåˆ é™¤æ¥¼å±‚ã€é‡å‘½åæ¥¼å±‚ã€å¤åˆ¶æ¥¼å±‚ï¼ˆå«å‡ ä½•ï¼‰ã€é‡æ’æ¥¼å±‚é¡ºåº
- **ç›¸å…³**: æ¥¼å±‚åç§°è¾“å…¥æ¡† `onChange={() => {}}` æ˜¯ç©ºæ“ä½œï¼ˆ`ZoneProperties.tsx:437`ï¼‰ï¼Œç”¨æˆ·è¾“å…¥è¢«é™é»˜ä¸¢å¼ƒ
- **ä¿®å¤å»ºè®®**: æ–°å¢ `removeStory`ã€`renameStory`ã€`duplicateStory`ã€`reorderStory` action

### H-07 ZoneAssignment ç¼ºå°‘åˆå§‹æµ“åº¦å­—æ®µ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/geometry.ts:90-97`
- **ç°è±¡**: æ—  `initialConcentration` å­—æ®µï¼Œç¬æ€æ¨¡æ‹Ÿæ— æ³•è®¾ç½® C(t=0)ã€‚å…¨ä»£ç åº“æœç´¢ `initialConc` é›¶ç»“æœ
- **å½±å“**: æ‰€æœ‰ç¬æ€æ¨¡æ‹Ÿçš„åˆå§‹æµ“åº¦åªèƒ½ä¸º 0ï¼Œæ— æ³•æ¨¡æ‹Ÿå·²æœ‰æ±¡æŸ“ç‰©çš„è¡°å‡åœºæ™¯
- **ä¿®å¤å»ºè®®**: ZoneAssignment æ·»åŠ  `initialConcentrations: Record<string, number>`ï¼ˆspeciesId â†’ æµ“åº¦ï¼‰ï¼ŒdataBridge ä¼ é€’åˆ°å¼•æ“ JSON

### H-08 é”®ç›˜å¿«æ·é”®åœ¨è¾“å…¥æ¡†ä¸­è¯¯è§¦å‘ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:649`
- **ç°è±¡**: Canvas2D çš„é”®ç›˜å¤„ç†å™¨æœªæ£€æŸ¥ event.target æ˜¯å¦ä¸º input/textareaã€‚ç”¨æˆ·åœ¨å±æ€§é¢æ¿è¾“å…¥ "3" æ—¶ä¼šåˆ‡æ¢åˆ°çŸ©å½¢å·¥å…·
- **å¯¹æ¯”**: VerticalToolbar çš„å¤„ç†å™¨æ­£ç¡®åšäº† guardï¼ˆ`VerticalToolbar.tsx:22`: `if (e.target instanceof HTMLInputElement) return`ï¼‰
- **ä¿®å¤å»ºè®®**: Canvas2D keydown handler å¼€å¤´æ·»åŠ ç›¸åŒçš„ `HTMLInputElement`/`HTMLTextAreaElement` guard

### H-09 ç¨³æ€çƒ­åŠ›å›¾å°†å‹åŠ›æ˜¾ç¤ºä¸ºæµ“åº¦ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:326`
- **ç°è±¡**: æ³¨é‡Šå†™ "use pressure for heatmap in steady-state"ï¼Œå°† `nodeRes.pressure` èµ‹ç»™ `concentration` å­—æ®µã€‚é¢œè‰²æ ‡å°ºå’Œæ ‡ç­¾ï¼ˆ"ppm"ï¼‰æ˜¾ç¤ºçš„æ˜¯å‹åŠ›å€¼è€Œéæµ“åº¦å€¼
- **å½±å“**: ç”¨æˆ·çœ‹åˆ°çš„"æµ“åº¦çƒ­åŠ›å›¾"å®é™…æ˜¾ç¤ºçš„æ˜¯å‹åŠ›åˆ†å¸ƒï¼Œæ•°å€¼å’Œå•ä½å®Œå…¨é”™è¯¯
- **ä¿®å¤å»ºè®®**: ç¨³æ€ç»“æœä¸­ä½¿ç”¨ `nodeRes.concentration[speciesIndex]`ï¼Œæˆ–æ–°å¢ç‹¬ç«‹çš„å‹åŠ›çƒ­åŠ›å›¾æ¨¡å¼

### H-10 å·¥å…·æ åªæœ‰é—¨çª—ä¸¤ç§æ„ä»¶ï¼Œå…¶ä½™ 8 ç§éœ€æ›²çº¿æ“ä½œ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/VerticalToolbar/VerticalToolbar.tsx:7-14`
- **ç°è±¡**: åªæœ‰ door å’Œ window å·¥å…·æŒ‰é’®ã€‚æ”¾ç½® fan/duct/damper/opening/checkValve/selfRegVent ç­‰éœ€è¦å…ˆæ”¾é—¨å†åœ¨å±æ€§é¢æ¿æ”¹ç±»å‹ï¼Œæ“ä½œè·¯å¾„æé•¿
- **ä¿®å¤å»ºè®®**: æ–¹æ¡ˆ A: é—¨çª—æŒ‰é’®æ”¹ä¸ºä¸‹æ‹‰èœå•ï¼Œåˆ—å‡ºæ‰€æœ‰å¯æ”¾ç½®æ„ä»¶ç±»å‹ï¼›æ–¹æ¡ˆ B: æ–°å¢"æ„ä»¶"å·¥å…·æŒ‰é’®ï¼Œç‚¹å‡»åå¼¹å‡ºç±»å‹é€‰æ‹©é¢æ¿

### H-11 æ§åˆ¶æµç”»å¸ƒåªè¯»ï¼Œç¼–è¾‘ä¸å›å†™ store ğŸŸ¢
- **æ–‡ä»¶**: `app/src/control/ControlFlowCanvas.tsx`
- **ç°è±¡**: React Flow ä¸­æ‹–æ‹½èŠ‚ç‚¹ã€è¿çº¿çš„å˜æ›´ä¸å›å†™åˆ° `useAppStore.controlSystem`ã€‚`onConnect` handler åªåœ¨æœ¬åœ° state æ·»åŠ  edgeï¼Œä¸æ›´æ–°å…¨å±€ store
- **å½±å“**: æ§åˆ¶ç½‘ç»œè§†å›¾çº¯å±•ç¤ºï¼Œç”¨æˆ·åœ¨æ­¤åšçš„ä»»ä½•ç¼–è¾‘åœ¨åˆ‡æ¢å›ç”»å¸ƒåä¸¢å¤±
- **ä¿®å¤å»ºè®®**: `onNodesChange`/`onEdgesChange`/`onConnect` å›è°ƒä¸­åŒæ­¥æ›´æ–° `useAppStore.controlSystem`

### H-12 OccupantPanel åªè¯»æ—§ nodesï¼Œç”»å¸ƒæˆ¿é—´ä¸å¯é€‰ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/OccupantPanel/OccupantPanel.tsx:7`
- **ç°è±¡**: `rooms` åˆ—è¡¨åªç”¨ `nodes.filter(n => n.type === 'normal')`ï¼ˆæ—§ç‰ˆ AppStoreï¼‰ï¼Œä¸åˆå¹¶ canvas çš„ ZoneAssignmentã€‚ç”»å¸ƒç»˜åˆ¶çš„æˆ¿é—´ä¸å‡ºç°åœ¨å±…ä½è€…åŒºåŸŸä¸‹æ‹‰åˆ—è¡¨ä¸­
- **å½±å“**: canvas æ¨¡å¼ä¸‹å±…ä½è€…åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨
- **ä¿®å¤å»ºè®®**: åˆå¹¶ canvas zonesï¼Œå‚è€ƒ ContaminantPanel çš„åˆå¹¶é€»è¾‘ï¼ˆ`ContaminantPanel.tsx:117-126`ï¼‰

---

## å››ã€å¾…ä¿®å¤ â€” Medium (1)

### M-01 ä½“ç§¯è®¡ç®—å¿½ç•¥ç”¨æˆ·æ‰‹åŠ¨è¦†ç›– ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:74-76`
- **ç°è±¡**: å§‹ç»ˆä»å‡ ä½•é¢ç§¯ Ã— å±‚é«˜é‡ç®—ä½“ç§¯ï¼Œå¿½ç•¥ `zone.volume` ç”¨æˆ·ç¼–è¾‘å€¼
- **å½±å“**: ç”¨æˆ·åœ¨å±æ€§é¢æ¿æ‰‹åŠ¨ä¿®æ­£çš„ä½“ç§¯ï¼ˆå¦‚ä¸è§„åˆ™ç©ºé—´ï¼‰è¢«è¦†ç›–ï¼Œå¼•æ“æ”¶åˆ°é”™è¯¯ä½“ç§¯
- **ä¿®å¤å»ºè®®**: æ¯”è¾ƒè‡ªåŠ¨è®¡ç®—å€¼ä¸ store å€¼ï¼Œä¸åŒæ—¶å°Šé‡ç”¨æˆ·å€¼ï¼›æˆ–æ·»åŠ  `volumeOverride` æ ‡è®°

### M-02 è¾¹å±æ€§ï¼ˆå¢™é«˜ã€å¢™åšï¼‰ä¸å¯ç¼–è¾‘ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/PropertyPanel/ZoneProperties.tsx:138-142`
- **ç°è±¡**: å¢™é«˜ã€å¢™åšã€å†…å¤–å¢™ç±»å‹æ˜¾ç¤ºä¸ºé™æ€æ–‡æœ¬ï¼Œæ— ç¼–è¾‘åŠŸèƒ½ã€‚store ä¸­æ—  `updateEdge` action
- **å½±å“**: å¢™é«˜å½±å“ TwoWayFlow æµ®åŠ›è®¡ç®—ï¼ˆÎ”P = ÏgÎ”hï¼‰ï¼Œæ— æ³•ç¼–è¾‘æ„å‘³ç€æ— æ³•ç²¾ç¡®å»ºæ¨¡ä¸åŒé«˜åº¦çš„å¢™ä½“å¼€å£

### M-03 æ„ä»¶ç¼ºå°‘æ—¶é—´è¡¨ç»‘å®š ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/PropertyPanel/ZoneProperties.tsx:193-423`
- **ç°è±¡**: canvas æ¨¡å¼çš„ PlacementProperties æ—  scheduleId å­—æ®µå’Œ UIã€‚é£æœº/é˜€é—¨æ— æ³•ç»‘å®šè¿è¡Œæ—¶é—´è¡¨
- **å¯¹æ¯”**: æ—§ç‰ˆ LinkPropertiesï¼ˆ`PropertyPanel.tsx:334-354`ï¼‰æœ‰æ—¶é—´è¡¨ä¸‹æ‹‰é€‰æ‹©å™¨ï¼Œcanvas æ¨¡å¼é—æ¼äº†æ­¤åŠŸèƒ½
- **ä¿®å¤å»ºè®®**: PlacementProperties æ·»åŠ  scheduleId ä¸‹æ‹‰ï¼ŒdataBridge ä¼ é€’åˆ°å¼•æ“ JSON çš„ link.scheduleId

### M-04 æ¨¡å‹éªŒè¯è¿‡äºæµ…å±‚ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:285-327`
- **ç°è±¡**: åªæ£€æŸ¥æ¨¡å‹æ˜¯å¦ä¸ºç©ºå’Œæ„ä»¶æ˜¯å¦æœªé…ç½®ã€‚ä¸æ£€æŸ¥ï¼šä½“ç§¯â‰¤0ã€æ¸©åº¦è¶…èŒƒå›´ï¼ˆ<0Kï¼‰ã€å­¤ç«‹å¢™ä¸Šçš„æ„ä»¶ï¼ˆè¢«é™é»˜è·³è¿‡ L-14ï¼‰ã€è·¨ store å¼•ç”¨å®Œæ•´æ€§ï¼ˆscheduleId æŒ‡å‘ä¸å­˜åœ¨çš„æ—¶é—´è¡¨ï¼‰ã€é‡å¤ zoneId
- **ç›¸å…³**: TopBar åªæ˜¾ç¤ºç¬¬ä¸€æ¡è­¦å‘Šï¼ˆ`TopBar.tsx:38-43`ï¼‰ï¼Œå¤šæ¡è­¦å‘Šè¢«åï¼Œç”¨æˆ·åªçœ‹åˆ°ä¸€ä¸ªé—®é¢˜
- **ä¿®å¤å»ºè®®**: åˆ†å±‚éªŒè¯ï¼ˆç»“æ„â†’å‚æ•°â†’å¼•ç”¨å®Œæ•´æ€§ï¼‰ï¼Œæ”¶é›†æ‰€æœ‰è­¦å‘Šåä¸€æ¬¡æ€§å±•ç¤º

### M-05 æ¥¼å±‚æ— æ ‡é«˜å­—æ®µ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/geometry.ts:69-86`
- **ç°è±¡**: Story åªæœ‰ `level`ï¼ˆæ•´æ•°ç´¢å¼•ï¼‰å’Œ `floorToCeilingHeight`ï¼Œæ—  `elevation`ï¼ˆç»å¯¹æ ‡é«˜ï¼‰ã€‚dataBridge ç”¨ `level Ã— height` è®¡ç®—æ ‡é«˜ï¼ˆ`dataBridge.ts:82`ï¼‰ï¼Œå¯¹éå‡åŒ€å±‚é«˜å»ºç­‘ï¼ˆå¦‚åœ°ä¸‹å®¤ 3m + åœ°ä¸Š 2.7mï¼‰è®¡ç®—ä¸æ­£ç¡®
- **ä¿®å¤å»ºè®®**: Story æ·»åŠ  `elevation: number` å­—æ®µï¼ŒdataBridge ç›´æ¥ä½¿ç”¨è€Œéæ¨ç®—

### M-06 æ¥¼å±‚åˆ‡æ¢æ— ç›¸é‚»å±‚é€è§† ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx`
- **ç°è±¡**: ç¼–è¾‘æŸå±‚æ—¶çœ‹ä¸åˆ°ä¸Šä¸‹å±‚çš„å‡ ä½•è½®å»“ã€‚å¤šå±‚ç›¸ä¼¼å¸ƒå±€æ—¶ç”¨æˆ·å®¹æ˜“è¿·å¤±æ–¹å‘
- **ä¿®å¤å»ºè®®**: æ¸²æŸ“ç›¸é‚»å±‚å‡ ä½•ä¸ºæ·¡è‰²è™šçº¿å åŠ ï¼ˆç±»ä¼¼ SketchUp çš„ X-ray æ¨¡å¼ï¼‰ï¼Œé€æ˜åº¦ 0.15

### M-07 å•æ¥¼å±‚æ—¶æ¥¼å±‚åˆ‡æ¢å™¨éšè— ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/FloorSwitcher.tsx:35`
- **ç°è±¡**: `stories.length <= 1 && !activeStory` æ—¶è¿”å› nullã€‚ç”¨æˆ·çœ‹ä¸åˆ°æ¥¼å±‚æŒ‡ç¤ºå™¨ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•æ·»åŠ æ¥¼å±‚
- **ä¿®å¤å»ºè®®**: å§‹ç»ˆæ˜¾ç¤ºæ¥¼å±‚åˆ‡æ¢å™¨ï¼Œå•æ¥¼å±‚æ—¶æ˜¾ç¤º"1F"å’Œ"+"æŒ‰é’®

### M-08 æ­£äº¤çº¦æŸä¸é¡¶ç‚¹å¸é™„å†²çª ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/interaction.ts:42-47`
- **ç°è±¡**: é¡¶ç‚¹å¸é™„åªåœ¨ç»“æœæ°å¥½æ­£äº¤æ—¶ç”Ÿæ•ˆã€‚ç”¨æˆ·çœ‹åˆ°é¡¶ç‚¹é«˜äº®ï¼ˆè§†è§‰æš—ç¤ºå¯å¸é™„ï¼‰ï¼Œä½†å¢™ç«¯ç‚¹è·³åˆ°ç½‘æ ¼æ­£äº¤ä½ç½®è€Œéé¡¶ç‚¹
- **å½±å“**: é—­åˆæˆ¿é—´æ—¶æœ€åä¸€æ®µå¢™éš¾ä»¥ç²¾ç¡®å¸é™„åˆ°èµ·å§‹é¡¶ç‚¹ï¼Œäº§ç”Ÿå¾®å°ç¼éš™å¯¼è‡´ face æ— æ³•é—­åˆ
- **ä¿®å¤å»ºè®®**: å¸é™„ä¼˜å…ˆçº§æ”¹ä¸ºï¼šé¡¶ç‚¹å¸é™„ > æ­£äº¤çº¦æŸ > ç½‘æ ¼å¸é™„

### M-09 çŸ©å½¢å·¥å…·æ— é¡¶ç‚¹å¸é™„ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:497-507`
- **ç°è±¡**: çŸ©å½¢åªåšç½‘æ ¼å¸é™„ï¼Œä¸è°ƒç”¨ `findNearestVertex`ã€‚ä¸å·²æœ‰æˆ¿é—´å…±è§’æ—¶äº§ç”Ÿé‡å é¡¶ç‚¹è€Œéæ‹“æ‰‘è¿æ¥
- **å½±å“**: ç›¸é‚»æˆ¿é—´æ— æ³•å…±äº«å¢™ä½“ï¼Œgeometry ä¸­å‡ºç°é‡å¤é¡¶ç‚¹ï¼ŒrebuildFaces æ— æ³•æ­£ç¡®è¯†åˆ«å…±äº«è¾¹

### M-10 æ„ä»¶å‘½ä¸­åŒºåŸŸä¸è§†è§‰å¤§å°ä¸åŒ¹é… ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/interaction.ts:125-150`
- **ç°è±¡**: å‘½ä¸­æµ‹è¯•ç”¨ 10px ç‚¹è·ç¦»ï¼Œä½†æ¸²æŸ“å›¾æ ‡éšç¼©æ”¾å˜å¤§ï¼ˆæœ€å¤§ 90pxï¼‰ã€‚é«˜ç¼©æ”¾æ—¶ç‚¹å‡»å¯è§å›¾æ ‡è¾¹ç¼˜ä¼š miss
- **ä¿®å¤å»ºè®®**: å‘½ä¸­æµ‹è¯•åŠå¾„åº”éšç¼©æ”¾åŠ¨æ€è°ƒæ•´ï¼Œæˆ–ä½¿ç”¨æ¸²æŸ“å›¾æ ‡çš„å®é™… bounding box

### M-11 6 ç§å¼•æ“å…ƒä»¶æ—  canvas è¡¨ç¤º ğŸ”´
- **ç°è±¡**: SimpleGaseousFilterã€UVGIFilterã€SimpleParticleFilterã€SuperFilterã€QuadraticElementã€BackdraftDamper æ— æ³•åœ¨ canvas æ¨¡å¼æ”¾ç½®ã€‚FilterPanel ç»„ä»¶å­˜åœ¨ä½†æœªæ¡¥æ¥åˆ° canvas placement ç³»ç»Ÿã€‚åŸºç¡€ 10 ç§æ„ä»¶ç±»å‹å·²æœ‰ canvas å›¾æ ‡ï¼ˆdoor/window/opening/fan/duct/damper/filter/crack/srv/checkValveï¼‰
- **ä¿®å¤å»ºè®®**: æ‰©å±• `PlacementType` æšä¸¾ï¼Œä¸ºæ¯ç§é«˜çº§å…ƒä»¶æ·»åŠ  canvas å›¾æ ‡å’Œ dataBridge æ˜ å°„

### M-12 Duct/SRV/CheckValve ç¼ºå°‘è¯¦ç»†å‚æ•° UI ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/PropertyPanel/ZoneProperties.tsx`
- **ç°è±¡**: duct æ— ç›´å¾„/ç²—ç³™åº¦/å±€éƒ¨é˜»åŠ›ç³»æ•°é…ç½®ï¼›SRV æ— ç›®æ ‡æµé‡/å‹åŠ›èŒƒå›´ï¼›CheckValve æ—  C/n å‚æ•°ã€‚`EdgePlacement` æ¥å£ä¹Ÿç¼ºå°‘è¿™äº›å­—æ®µå®šä¹‰
- **ä¿®å¤å»ºè®®**: æŒ‰å…ƒä»¶ç±»å‹åˆ†åˆ«æ‰©å±• PlacementProperties è¡¨å•ï¼ŒEdgePlacement æ¥å£æ·»åŠ å¯¹åº”å¯é€‰å­—æ®µ

### M-13 åŒçŠ¶æ€å­˜å‚¨æ¶æ„å¯¼è‡´æ•°æ®æºä¸ä¸€è‡´ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/store/useAppStore.ts` + `app/src/store/useCanvasStore.ts`
- **ç°è±¡**: `useAppStore`ï¼ˆæ—§èŠ‚ç‚¹/é“¾æ¥æ¨¡å‹ï¼‰ä¸ `useCanvasStore`ï¼ˆå‡ ä½•æ¨¡å‹ï¼‰å¹¶å­˜ã€‚`dataBridge.ts:46` æœ‰ fallback è·¯å¾„åœ¨ canvas æ—  zones æ—¶ä½¿ç”¨æ—§ storeã€‚å„é¢æ¿æ•°æ®æºä¸ç»Ÿä¸€ï¼šContaminantPanel åˆå¹¶ä¸¤è€…ã€OccupantPanel åªè¯»æ—§ nodesï¼ˆH-12ï¼‰ã€AHSPanel åªè¯» canvas zones
- **å½±å“**: åŒä¸€æˆ¿é—´åœ¨ä¸åŒé¢æ¿ä¸­å¯èƒ½æ˜¾ç¤ºä¸åŒåç§°æˆ–å®Œå…¨ç¼ºå¤±
- **ä¿®å¤å»ºè®®**: é•¿æœŸæ–¹æ¡ˆï¼šç»Ÿä¸€ä¸ºå•ä¸€å‡ ä½•æ¨¡å‹ï¼ŒåºŸå¼ƒæ—§ node/link æ¨¡å¼ï¼›çŸ­æœŸæ–¹æ¡ˆï¼šæ‰€æœ‰é¢æ¿ç»Ÿä¸€ä½¿ç”¨åˆå¹¶åçš„æˆ¿é—´åˆ—è¡¨

### M-14 AHSPanel åªè¯» canvas zonesï¼Œä¸å…¶ä»–é¢æ¿ä¸ä¸€è‡´ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/AHSPanel/AHSPanel.tsx:33`
- **ç°è±¡**: `ZoneConnectionEditor` åªä» canvas store è·å– zonesï¼Œä¸åˆå¹¶æ—§ç‰ˆ AppStore nodesã€‚ä¸ ContaminantPanel çš„åˆå¹¶é€»è¾‘ä¸ä¸€è‡´
- **å½±å“**: æ—§ç‰ˆæ¨¡å¼åˆ›å»ºçš„æˆ¿é—´ä¸å‡ºç°åœ¨ AHS åŒºåŸŸè¿æ¥åˆ—è¡¨ä¸­
- **ä¿®å¤å»ºè®®**: ç»Ÿä¸€ä½¿ç”¨ä¸ ContaminantPanel ç›¸åŒçš„åˆå¹¶é€»è¾‘

### M-15 ContaminantPanel æºæ˜¾ç¤ºåç§°å›é€€ä¸º ID ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/ContaminantPanel/ContaminantPanel.tsx:157`
- **ç°è±¡**: `SourceSection` åˆå¹¶äº†æ—§ nodes å’Œ canvas zones åˆ° `rooms` åˆ—è¡¨ï¼Œä½†ç¬¬ 157 è¡Œçš„ `zone` å˜é‡åªæœç´¢æ—§ `nodes`ï¼Œä¸æœç´¢åˆå¹¶åçš„ `rooms`ã€‚canvas-only zones çš„æºæ˜¾ç¤ºåç§°ä¸º `#${src.zoneId}` è€Œéå®é™…åŒºåŸŸå
- **ä¿®å¤å»ºè®®**: å°† `zone` æŸ¥æ‰¾æ”¹ä¸ºæœç´¢åˆå¹¶åçš„ `rooms` åˆ—è¡¨

### M-16 åˆ‡æ¢ Placement/Source ç±»å‹æ—¶æ—§å‚æ•°æœªæ¸…é™¤ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/PropertyPanel/ZoneProperties.tsx` (PlacementProperties), `app/src/components/ContaminantPanel/ContaminantPanel.tsx` (SourceSection)
- **ç°è±¡**: åˆ‡æ¢ placement ç±»å‹ï¼ˆå¦‚ fanâ†’doorï¼‰æ—¶ `maxFlow`/`shutoffPressure` ç­‰æ—§ç±»å‹å‚æ•°æ®‹ç•™åœ¨å¯¹è±¡ä¸Šã€‚åˆ‡æ¢ source ç±»å‹ï¼ˆå¦‚ ExponentialDecayâ†’Burstï¼‰åŒç†
- **å½±å“**: æ®‹ç•™å‚æ•°å¯èƒ½è¢« dataBridge é”™è¯¯è¯»å–ä¼ ç»™å¼•æ“
- **ä¿®å¤å»ºè®®**: ç±»å‹åˆ‡æ¢æ—¶é‡ç½®ä¸ºè¯¥ç±»å‹çš„é»˜è®¤å‚æ•°é›†

### M-17 dataBridge scaleFactor åº”ç”¨ä¸ä¸€è‡´ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:82, 132`
- **ç°è±¡**: `linkElevation`ï¼ˆç¬¬ 132 è¡Œï¼‰ä¹˜ä»¥äº† `sf`ï¼ˆscaleFactorï¼‰ï¼Œä½† node `elevation`ï¼ˆç¬¬ 82 è¡Œï¼‰æœªä¹˜ä»¥ `sf`ã€‚å½“ `scaleFactor != 1.0` æ—¶ï¼ŒèŠ‚ç‚¹å’Œé“¾æ¥çš„æ ‡é«˜ä¸ä¸€è‡´
- **å½±å“**: é 1:1 æ¯”ä¾‹æ¨¡å‹ä¸­æµ®åŠ›é©±åŠ¨æ°”æµè®¡ç®—é”™è¯¯ï¼ˆÎ”P = ÏgÂ·Î”h ä¸­çš„ h ä¸ä¸€è‡´ï¼‰
- **ä¿®å¤å»ºè®®**: ç»Ÿä¸€ node å’Œ link çš„ elevation ç¼©æ”¾å¤„ç†

### M-18 TS FlowElementType ä¸ JSON Schema ä¸åŒæ­¥ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/types/index.ts` vs `schemas/topology.schema.json`
- **ç°è±¡**: TypeScript å®šä¹‰äº† `SelfRegulatingVent`ã€`CheckValve`ã€`SupplyDiffuser`ã€`ReturnGrille` ç­‰ç±»å‹ï¼Œä½† `topology.schema.json` åªåˆ—å‡º 6 ç§åŸºç¡€ç±»å‹ï¼ˆPowerLawOrifice, TwoWayFlow, Fan, Duct, Damper, Filterï¼‰
- **å½±å“**: Schema éªŒè¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰ä¼šæ‹’ç»åˆæ³•çš„å…ƒä»¶ç±»å‹
- **ä¿®å¤å»ºè®®**: æ›´æ–° schema ä¸ TS ç±»å‹å’Œ C++ å¼•æ“å…ƒä»¶åˆ—è¡¨ä¿æŒåŒæ­¥

### M-19 å¼•æ“è·¯å¾„ä»…é™ Windows ğŸŸ¢
- **æ–‡ä»¶**: `app/src-tauri/src/lib.rs` (find_engine_path)
- **ç°è±¡**: åªæŸ¥æ‰¾ `contam_engine.exe`ï¼Œæ—  macOSï¼ˆæ— æ‰©å±•åæˆ– `.app`ï¼‰å’Œ Linuxï¼ˆæ— æ‰©å±•åï¼‰æ”¯æŒ
- **å½±å“**: é Windows å¹³å°æ— æ³•æ‰¾åˆ°å¼•æ“å¯æ‰§è¡Œæ–‡ä»¶
- **ä¿®å¤å»ºè®®**: æ ¹æ® `cfg!(target_os)` æ¡ä»¶ç¼–è¯‘é€‰æ‹©æ­£ç¡®çš„å¯æ‰§è¡Œæ–‡ä»¶å

---

## äº”ã€å¾…ä¿®å¤ â€” Low (0, å…¨éƒ¨å·²ä¿®å¤)

### L-01 çŸ©å½¢å·¥å…·çŠ¶æ€åœ¨ ref ä¸­ï¼Œundo/redo ç›²åŒº ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:61-62`
- **ç°è±¡**: `rectStartRef`/`rectEndRef` æ˜¯ React refï¼Œä¸åœ¨ Zustand store ä¸­ã€‚ç»˜åˆ¶ä¸­é€” Ctrl+Z ä¼šæ’¤é”€ä¸Šä¸€ä¸ªå·²å®Œæˆæ“ä½œï¼Œä½†çŸ©å½¢é¢„è§ˆçŠ¶æ€ä¸å˜ï¼Œå¯¼è‡´çŠ¶æ€ä¸åŒæ­¥
- **ä¿®å¤å»ºè®®**: å°†çŸ©å½¢ç»˜åˆ¶çŠ¶æ€ç§»å…¥ storeï¼Œæˆ–åœ¨ undo æ—¶æ¸…é™¤ ref

### L-02 çŸ©å½¢æœ€å°å°ºå¯¸æ‹’ç»æ— åé¦ˆ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:511`
- **ç°è±¡**: `w < 0.3 || h < 0.3` æ—¶é™é»˜ä¸¢å¼ƒï¼Œç”¨æˆ·ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ¿é—´æ²¡åˆ›å»º
- **ä¿®å¤å»ºè®®**: æ˜¾ç¤º toast æç¤º"çŸ©å½¢å°ºå¯¸è¿‡å°ï¼ˆæœ€å° 0.3m Ã— 0.3mï¼‰"

### L-03 åŒºåŸŸå¡«å……æ‚¬åœåé¦ˆå¤ªå¼± ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/renderer.ts:150`
- **ç°è±¡**: é»˜è®¤ 0.2 vs æ‚¬åœ 0.3 é€æ˜åº¦å·®å¼‚å‡ ä¹ä¸å¯è§ï¼Œç”¨æˆ·éš¾ä»¥ç¡®è®¤æ‚¬åœäº†å“ªä¸ªåŒºåŸŸ
- **ä¿®å¤å»ºè®®**: æ‚¬åœé€æ˜åº¦æ”¹ä¸º 0.45 æˆ–æ·»åŠ è¾¹æ¡†é«˜äº®

### L-04 å³é”®èœå•"ç¼–è¾‘ç»„ä»¶å±æ€§"æ— åŠŸèƒ½ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/components/ContextMenu.tsx:139`
- **ç°è±¡**: æŒ‰é’®åªè°ƒç”¨ `close()`ï¼Œä¸é€‰ä¸­æ„ä»¶ä¹Ÿä¸æ‰“å¼€å±æ€§é¢æ¿
- **ä¿®å¤å»ºè®®**: ç‚¹å‡»åè°ƒç”¨ `setSelectedPlacementId(id)` å¹¶èšç„¦å±æ€§é¢æ¿

### L-05 å³é”®èœå•ä½¿ç”¨è¿‡æœŸæ‚¬åœçŠ¶æ€ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/components/ContextMenu.tsx:57-59`
- **ç°è±¡**: `hoveredPlacementId` ä»æœªè¢«è®¾ç½®ï¼ˆè§ H-02 é—¨çª—æ— æ‚¬åœé¢„è§ˆï¼‰ï¼Œå³é”®ç‚¹å‡»æ„ä»¶æ˜¾ç¤ºé€šç”¨èœå•è€Œéæ„ä»¶ä¸“å±èœå•
- **ä¾èµ–**: ä¿®å¤ H-02 åæ­¤é—®é¢˜å¯èƒ½è‡ªåŠ¨è§£å†³

### L-06 é‡å¤é”®ç›˜ç›‘å¬å™¨ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:648-706` vs `app/src/components/VerticalToolbar/VerticalToolbar.tsx:20-29`
- **ç°è±¡**: ä¸¤å¤„éƒ½ç›‘å¬æ•°å­—é”®åˆ‡æ¢å·¥å…·ï¼ŒåŒä¸€æŒ‰é”®è§¦å‘ä¸¤æ¬¡ `setToolMode`
- **ä¿®å¤å»ºè®®**: ç§»é™¤ Canvas2D ä¸­çš„å·¥å…·åˆ‡æ¢ç›‘å¬ï¼Œç»Ÿä¸€ç”± VerticalToolbar å¤„ç†

### L-07 ä½ç¼©æ”¾æ—¶å¢™ä½“é•¿åº¦æ ‡ç­¾æ¶ˆå¤± ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/renderer.ts:408`
- **ç°è±¡**: `zoom > 10` æ‰æ˜¾ç¤ºé•¿åº¦æ ‡ç­¾ã€‚ç¼©æ”¾ 5-10 èŒƒå›´ï¼ˆå¤§å°ºåº¦å»ºç­‘å¸ƒå±€å¸¸ç”¨ï¼‰æ—¶æ— å°ºå¯¸åé¦ˆ
- **ä¿®å¤å»ºè®®**: é˜ˆå€¼é™ä½åˆ° `zoom > 3`ï¼Œæˆ–æ ¹æ®å¢™ä½“å±å¹•åƒç´ é•¿åº¦å†³å®šæ˜¯å¦æ˜¾ç¤º

### L-08 æ— ç¼©æ”¾é€‚é…/ç¼©æ”¾åˆ°é€‰æ‹©åŠŸèƒ½ ğŸŸ¢
- **ç°è±¡**: åŠ è½½é¡¹ç›®åéœ€æ‰‹åŠ¨å¹³ç§»ç¼©æ”¾æ‰¾åˆ°å»ºç­‘ã€‚ç¼ºå°‘ zoom-to-fitï¼ˆé€‚é…å…¨éƒ¨å‡ ä½•ï¼‰å’Œ zoom-to-selectionï¼ˆèšç„¦é€‰ä¸­å…ƒç´ ï¼‰
- **ä¿®å¤å»ºè®®**: æ·»åŠ å·¥å…·æ æŒ‰é’®ï¼Œè®¡ç®—æ‰€æœ‰é¡¶ç‚¹çš„ bounding box åè®¾ç½® camera

### L-09 ç›¸æœºçŠ¶æ€é‡å¤å­˜å‚¨ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:48` vs `app/src/store/useCanvasStore.ts:65`
- **ç°è±¡**: camera åœ¨ refï¼ˆCanvas2D å†…éƒ¨æ¸²æŸ“ç”¨ï¼‰å’Œ storeï¼ˆæŒä¹…åŒ–/è·¨ç»„ä»¶å…±äº«ï¼‰ä¸­å„å­˜ä¸€ä»½ï¼Œå¯èƒ½ä¸åŒæ­¥
- **ä¿®å¤å»ºè®®**: ä»¥ store ä¸ºå•ä¸€æ•°æ®æºï¼ŒCanvas2D é€šè¿‡ selector è¯»å–

### L-10 hitTest/buildVertexMap æ¯å¸§å¤šæ¬¡é‡å»º ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/interaction.ts:13-19`, `app/src/canvas/renderer.ts`
- **ç°è±¡**: æ¯æ¬¡ hitTest æ„å»º 3 æ¬¡ Mapï¼ˆvertexMap, edgeMap, faceMapï¼‰ï¼Œæ¯å¸§æ¸²æŸ“æ„å»º 6+ æ¬¡ã€‚å‡ ä½•ä¸å˜æ—¶å®Œå…¨æ˜¯æµªè´¹
- **ä¿®å¤å»ºè®®**: åœ¨å¸§é¡¶éƒ¨æ„å»ºä¸€æ¬¡ Map ä¼ é€’ç»™æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œæˆ–ä½¿ç”¨ useMemo ç¼“å­˜

### L-11 èƒŒæ™¯å›¾ useEffect æ— ä¾èµ–æ•°ç»„ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:87-102`
- **ç°è±¡**: æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ useEffectï¼Œè™½æœ‰ early-returnï¼ˆURL æœªå˜æ—¶è·³è¿‡ï¼‰ä½†ä»æœ‰ä¸å¿…è¦çš„å‡½æ•°è°ƒç”¨å¼€é”€
- **ä¿®å¤å»ºè®®**: æ·»åŠ  `[bgImageUrl]` ä¾èµ–æ•°ç»„

### L-12 alpha é’³ä½ [0.05, 0.95] æ— è§†è§‰æç¤º ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/interaction.ts:194`
- **ç°è±¡**: ç”¨æˆ·ç‚¹å‡»å¢™è§’é™„è¿‘æ—¶æ„ä»¶é™é»˜åç§»åˆ° 0.05 æˆ– 0.95 ä½ç½®ï¼Œæ— ä»»ä½•æç¤º
- **ä¿®å¤å»ºè®®**: é’³ä½æ—¶çŸ­æš‚é—ªçƒæ„ä»¶å›¾æ ‡æˆ–æ˜¾ç¤º tooltip

### L-13 åŒä¸€è¾¹å¯é‡å¤æ”¾ç½®æ„ä»¶ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/store/useCanvasStore.ts:454-473`
- **ç°è±¡**: `addPlacement` ä¸æ£€æŸ¥åŒä¸€ edge åŒä¸€ alpha ä½ç½®æ˜¯å¦å·²æœ‰æ„ä»¶ï¼ŒåŒå‡»ä¼šäº§ç”Ÿå®Œå…¨é‡å çš„ä¸¤ä¸ªæ„ä»¶
- **ä¿®å¤å»ºè®®**: æ·»åŠ å»é‡æ£€æŸ¥ï¼Œç›¸åŒ edge + alpha è·ç¦» < 0.02 æ—¶æ‹’ç»æˆ–æ›¿æ¢

### L-14 å­¤ç«‹å¢™ä¸Šçš„æ„ä»¶è¢«é™é»˜è·³è¿‡ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:109-112`
- **ç°è±¡**: edge.faceIds ä¸ºç©ºæ—¶ï¼ˆå­¤ç«‹å¢™ï¼Œä¸å›´åˆä»»ä½•æˆ¿é—´ï¼‰æ„ä»¶è¢«è·³è¿‡ï¼Œæ— éªŒè¯è­¦å‘Šã€‚ç”¨æˆ·ä¸çŸ¥é“ä¸ºä»€ä¹ˆæŸäº›æ„ä»¶æ²¡å‡ºç°åœ¨ä»¿çœŸä¸­
- **ä¿®å¤å»ºè®®**: åœ¨ M-04 éªŒè¯é€»è¾‘ä¸­æ·»åŠ "å­¤ç«‹å¢™ä¸Šæœ‰æ„ä»¶"è­¦å‘Š

### L-15 çŸ©å½¢å·¥å…·æç¤ºæ–‡å­—ä¸å®é™…è¡Œä¸ºä¸ç¬¦ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/VerticalToolbar/VerticalToolbar.tsx:9`
- **ç°è±¡**: æç¤º"æ‹–æ‹½ç»˜åˆ¶çŸ©å½¢æˆ¿é—´"ï¼Œå®é™…æ˜¯ä¸¤æ¬¡ç‚¹å‡»ï¼ˆç‚¹å‡»èµ·ç‚¹ â†’ ç‚¹å‡»ç»ˆç‚¹ï¼‰ï¼Œä¸æ˜¯æ‹–æ‹½
- **ä¿®å¤å»ºè®®**: æ”¹ä¸º"ç‚¹å‡»ä¸¤ç‚¹ç»˜åˆ¶çŸ©å½¢æˆ¿é—´"

### L-16 çª—æˆ·å·¥å…·æ— å­—æ¯å¿«æ·é”® ğŸŸ¢
- **æ–‡ä»¶**: `app/src/canvas/Canvas2D.tsx:682`
- **ç°è±¡**: é—¨æœ‰ D é”®ï¼Œçª—åªæœ‰æ•°å­— 5ï¼Œæ‰“ç ´äº†å…¶ä»–å·¥å…·çš„å­—æ¯å¿«æ·é”®æ¨¡å¼ï¼ˆS=é€‰æ‹©, W=å¢™ä½“, R=çŸ©å½¢, D=é—¨ï¼‰
- **ä¿®å¤å»ºè®®**: æ·»åŠ  N é”®ï¼ˆwiNdowï¼‰æˆ– G é”®ï¼ˆGlassï¼‰

### L-17 activeStoryId åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸² ğŸŸ¢
- **æ–‡ä»¶**: `app/src/store/useCanvasStore.ts:162,566-569`
- **ç°è±¡**: åˆå§‹ä¸º `''`ï¼Œæ¨¡å—åŠ è½½åæ‰ patch ä¸ºå®é™… storyIdã€‚çŸ­æš‚çª—å£å†… store çŠ¶æ€ä¸ä¸€è‡´ï¼Œå¯èƒ½å¯¼è‡´é¦–å¸§æ¸²æŸ“å¼‚å¸¸
- **ä¿®å¤å»ºè®®**: åˆå§‹åŒ–æ—¶ç›´æ¥è®¾ç½®ä¸ºç¬¬ä¸€ä¸ª story çš„ idï¼Œæˆ–ä½¿ç”¨ lazy initializer

### L-18 updateStoryHeight ä¸é‡ç®—å·²æœ‰åŒºåŸŸä½“ç§¯ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/store/useCanvasStore.ts:399-401`
- **ç°è±¡**: ä¿®æ”¹å±‚é«˜åå·²æœ‰åŒºåŸŸçš„ä½“ç§¯ä»ä¸ºæ—§å€¼ï¼ˆvolume = area Ã— æ—§å±‚é«˜ï¼‰ï¼Œç›´åˆ°ä¸‹æ¬¡ rebuildFaces æ‰æ›´æ–°
- **ä¿®å¤å»ºè®®**: `updateStoryHeight` å†…éå†è¯¥å±‚æ‰€æœ‰ ZoneAssignmentï¼Œé‡ç®— volume = area Ã— newHeight

### L-19 InputField ç»„ä»¶åœ¨ 5 ä¸ªæ–‡ä»¶ä¸­é‡å¤å®šä¹‰ ğŸŸ¢
- **æ–‡ä»¶**: `PropertyPanel.tsx`, `ZoneProperties.tsx`, `ContaminantPanel.tsx`, `AHSPanel.tsx`, `FilterPanel.tsx`
- **ç°è±¡**: æ¯ä¸ªæ–‡ä»¶å„è‡ªå®šä¹‰äº†ç­¾åç•¥æœ‰ä¸åŒçš„ `InputField` ç»„ä»¶ï¼ˆæœ‰çš„æ¥å— `string | number`ï¼Œæœ‰çš„åªæ¥å— `number`ï¼‰
- **å½±å“**: ç»´æŠ¤æˆæœ¬é«˜ï¼Œè¡Œä¸ºä¸ä¸€è‡´
- **ä¿®å¤å»ºè®®**: æå–ä¸º `app/src/components/ui/InputField.tsx` å…±äº«ç»„ä»¶ï¼Œç»Ÿä¸€ç­¾å

### L-20 æš—è‰²æ¨¡å¼ä¸æŒä¹…åŒ– ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/TopBar/TopBar.tsx`
- **ç°è±¡**: æš—è‰²æ¨¡å¼åˆ‡æ¢ä½¿ç”¨ `useState` + `document.documentElement.classList.toggle('dark')`ï¼Œåˆ·æ–°é¡µé¢åä¸¢å¤±ã€‚å…¶ä»–ç»„ä»¶æ— æ³•è¯»å–å½“å‰ä¸»é¢˜çŠ¶æ€
- **ä¿®å¤å»ºè®®**: ä½¿ç”¨ `localStorage` æŒä¹…åŒ–ï¼Œæˆ–å°†ä¸»é¢˜çŠ¶æ€ç§»å…¥ Zustand store

### L-21 å¤šå¤„ hover é¢œè‰²ç¼ºå°‘æš—è‰²æ¨¡å¼å˜ä½“ ğŸŸ¢
- **æ–‡ä»¶**: `OccupantPanel.tsx`, `AHSPanel.tsx` ç­‰
- **ç°è±¡**: `hover:bg-emerald-50`ã€`hover:bg-indigo-50`ã€`hover:bg-teal-50` ç­‰äº®è‰² hover é¢œè‰²æ— å¯¹åº” `dark:` å˜ä½“ï¼Œæš—è‰²æ¨¡å¼ä¸‹æ‚¬åœæ•ˆæœå‡ ä¹ä¸å¯è§
- **ä¿®å¤å»ºè®®**: æ·»åŠ  `dark:hover:bg-emerald-950/30` ç­‰æš—è‰²å˜ä½“

### L-22 AHS é¢æ¿æ¸©åº¦å•ä½ä¸ä¸€è‡´ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/AHSPanel/AHSPanel.tsx:157`
- **ç°è±¡**: ä¾›æ°”æ¸©åº¦è¾“å…¥ç›´æ¥ä½¿ç”¨å¼€å°”æ–‡ï¼ˆç”¨æˆ·éœ€è¾“å…¥ 295.15ï¼‰ï¼Œè€Œ AmbientSettings ä¸­ç¯å¢ƒæ¸©åº¦æ˜¾ç¤ºä¸ºæ‘„æ°åº¦ã€‚åŒä¸€é¢æ¿å†…å•ä½ä¸ç»Ÿä¸€
- **ä¿®å¤å»ºè®®**: ç»Ÿä¸€ä¸ºæ‘„æ°åº¦è¾“å…¥ï¼Œå†…éƒ¨è½¬æ¢ä¸ºå¼€å°”æ–‡å­˜å‚¨

### L-23 å±…ä½è€…æ—¶é—´è¾“å…¥ä½¿ç”¨åŸå§‹ç§’æ•° ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/OccupantPanel/OccupantPanel.tsx`
- **ç°è±¡**: ç§»åŠ¨æ—¶é—´è¡¨çš„æ—¶é—´è¾“å…¥ä¸ºåŸå§‹ç§’æ•°ï¼ˆå¦‚ 28800ï¼‰ï¼Œ`formatTime` helper ä»…ç”¨äº `title` tooltipã€‚ç”¨æˆ·éœ€å¿ƒç®—ç§’æ•°ä¸å°æ—¶çš„æ¢ç®—
- **ä¿®å¤å»ºè®®**: æ”¹ä¸º HH:MM æ ¼å¼è¾“å…¥ï¼Œæˆ–æ·»åŠ æ—¶é—´é€‰æ‹©å™¨ç»„ä»¶

### L-24 å¤©æ°”æ–‡ä»¶è§£æé™é»˜å¤±è´¥ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/WeatherPanel/WeatherPanel.tsx:7-38`
- **ç°è±¡**: `parseWthFile` é‡åˆ°æ ¼å¼é”™è¯¯çš„è¡Œæ—¶é™é»˜è·³è¿‡ï¼Œä¸æŠ¥å‘Šä»»ä½•é”™è¯¯ã€‚æ–‡ä»¶æ ¼å¼å®Œå…¨é”™è¯¯æ—¶ç”¨æˆ·å¾—åˆ° 0 æ¡è®°å½•ï¼Œæ— ä»»ä½•è§£é‡Š
- **ä¿®å¤å»ºè®®**: æ”¶é›†è§£æé”™è¯¯å¹¶åœ¨ UI ä¸­æ˜¾ç¤ºï¼ˆå¦‚ "ç¬¬ X è¡Œæ ¼å¼é”™è¯¯ï¼Œå·²è·³è¿‡ N è¡Œ"ï¼‰

### L-25 å‘¨æ—¶é—´è¡¨æ— å¯è§†åŒ–é¢„è§ˆ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/ScheduleEditor/WeekScheduleEditor.tsx`
- **ç°è±¡**: æ—¥æ—¶é—´è¡¨æœ‰ ECharts æŠ˜çº¿å›¾é¢„è§ˆï¼Œä½†å‘¨æ—¶é—´è¡¨åªæœ‰æ–‡å­—åˆ—è¡¨ï¼Œæ— æ³•ç›´è§‚çœ‹åˆ°ä¸€å‘¨çš„æ—¶é—´åˆ†å¸ƒ
- **ä¿®å¤å»ºè®®**: æ·»åŠ  7 å¤©å †å æ¡å½¢å›¾æˆ–çƒ­åŠ›å›¾é¢„è§ˆ

### L-26 åˆ é™¤æ—¶é—´è¡¨æœªæ¸…ç† AHS/Link å¼•ç”¨ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/ScheduleEditor/ScheduleEditor.tsx:175-178`
- **ç°è±¡**: `removeScheduleFromStore` åªæ¸…ç†äº† source çš„ `scheduleId` å¼•ç”¨ï¼Œæœªæ¸…ç† AHS é…ç½®å’Œ link ç»‘å®šä¸­çš„ scheduleId å¼•ç”¨
- **å½±å“**: åˆ é™¤æ—¶é—´è¡¨åï¼Œå¼•ç”¨è¯¥æ—¶é—´è¡¨çš„ AHS/link æŒæœ‰æ‚¬ç©º IDï¼Œå¼•æ“å¯èƒ½æŠ¥é”™æˆ–ä½¿ç”¨é»˜è®¤è¡Œä¸º
- **ä¿®å¤å»ºè®®**: éå†æ‰€æœ‰ AHS é…ç½®å’Œ linksï¼Œæ¸…é™¤å¯¹å·²åˆ é™¤ scheduleId çš„å¼•ç”¨

### L-27 å¼•æ“è°ƒç”¨æ— è¶…æ—¶æœºåˆ¶ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/TopBar/TopBar.tsx` (handleRun), `app/src-tauri/src/lib.rs` (run_engine)
- **ç°è±¡**: Tauri `run_engine` å‘½ä»¤æ— è¶…æ—¶è®¾ç½®ã€‚å¼•æ“è¿›ç¨‹æŒ‚èµ·ï¼ˆå¦‚æ­»å¾ªç¯æˆ–æå¤§æ¨¡å‹ï¼‰æ—¶ UI æ— é™æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œæ— æ³•å–æ¶ˆ
- **ä¿®å¤å»ºè®®**: Rust ç«¯æ·»åŠ  `tokio::time::timeout`ï¼Œå‰ç«¯æ·»åŠ å–æ¶ˆæŒ‰é’®

### L-28 ä»¿çœŸè¿›åº¦æ¡ä¸ºå‡åŠ¨ç”» ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/TopBar/TopBar.tsx`
- **ç°è±¡**: ä»¿çœŸè¿è¡Œæ—¶æ˜¾ç¤º `animate-pulse` è„‰å†²åŠ¨ç”»ï¼Œä¸åæ˜ å®é™…è¿›åº¦ã€‚ç”¨æˆ·æ— æ³•åˆ¤æ–­ä»¿çœŸæ˜¯å¦å¡ä½
- **ä¿®å¤å»ºè®®**: æ–¹æ¡ˆ A: å¼•æ“æ”¯æŒè¿›åº¦å›è°ƒï¼ˆé€šè¿‡ stdout æˆ– IPCï¼‰ï¼›æ–¹æ¡ˆ B: è‡³å°‘æ˜¾ç¤ºå·²è¿è¡Œæ—¶é—´

### L-29 addWall ä¸ confirmWall é€»è¾‘é‡å¤ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/store/useCanvasStore.ts:261-309` vs `312-349`
- **ç°è±¡**: zone è‡ªåŠ¨åˆ†é…ä»£ç ï¼ˆæŸ¥æ‰¾æ–° faceã€åˆ†é… zoneIdã€é¢œè‰²ã€åç§°ï¼‰åœ¨ä¸¤ä¸ªæ–¹æ³•ä¸­å®Œå…¨å¤åˆ¶ç²˜è´´
- **ä¿®å¤å»ºè®®**: æå–ä¸º `autoAssignZones(story, geo, stories)` å…±äº«å‡½æ•°

### L-30 setAmbient ä¸å¿…è¦å±•å¼€æ•´ä¸ª state ğŸŸ¢
- **æ–‡ä»¶**: `app/src/store/useAppStore.ts:97`
- **ç°è±¡**: `set((state) => ({ ...state, ...updates }))` å±•å¼€äº†æ•´ä¸ª state åŒ…æ‹¬æ‰€æœ‰ action å‡½æ•°ï¼Œè™½ç„¶åŠŸèƒ½æ­£ç¡®ä½†ä¸å¿…è¦
- **ä¿®å¤å»ºè®®**: æ”¹ä¸º `set(updates)` æˆ– `set(() => updates)`

### L-31 findOrCreateVertex çº¿æ€§æœç´¢æ€§èƒ½ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/geometry.ts:188-196`
- **ç°è±¡**: æ¯æ¬¡è°ƒç”¨éå†æ‰€æœ‰é¡¶ç‚¹åšè·ç¦»è®¡ç®—ï¼ŒO(n) å¤æ‚åº¦ã€‚å¤æ‚æˆ·å‹ï¼ˆ100+ é¡¶ç‚¹ï¼‰æ—¶æ¯æ¬¡æ·»åŠ å¢™ä½“éƒ½éœ€è¦å…¨é‡æ‰«æ
- **ä¿®å¤å»ºè®®**: ä½¿ç”¨ç©ºé—´ç´¢å¼•ï¼ˆå¦‚ç®€å•çš„ç½‘æ ¼å“ˆå¸Œï¼‰åŠ é€Ÿè¿‘é‚»æŸ¥æ‰¾

### L-32 æ­»ä¾èµ– @tauri-apps/plugin-shell ğŸŸ¢
- **æ–‡ä»¶**: `app/package.json`
- **ç°è±¡**: `@tauri-apps/plugin-shell` åœ¨ dependencies ä¸­ä½†å…¨ä»£ç åº“æ— ä»»ä½• import
- **ä¿®å¤å»ºè®®**: `npm uninstall @tauri-apps/plugin-shell`

### L-33 æ­»ä»£ç  downloadAsFile ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts:269`
- **ç°è±¡**: `downloadAsFile` å‡½æ•°å·²å®šä¹‰ä½†ä»æœªè¢«è°ƒç”¨ã€‚TopBar ä½¿ç”¨çš„æ˜¯ `fileOps.ts` ä¸­çš„ `downloadFile`
- **ä¿®å¤å»ºè®®**: åˆ é™¤ `dataBridge.ts` ä¸­çš„ `downloadAsFile` å‡½æ•°

### L-34 Placement çŠ¶æ€ç”¨ emoji æ˜¾ç¤º ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/PropertyPanel/ZoneProperties.tsx:419`
- **ç°è±¡**: é…ç½®çŠ¶æ€ä½¿ç”¨ `âœ… å·²é…ç½®` / `ğŸ”´ æœªé…ç½®` emojiï¼Œä¸é¡¹ç›®å…¶ä»–éƒ¨åˆ†ä½¿ç”¨ Lucide å›¾æ ‡çš„é£æ ¼ä¸ä¸€è‡´
- **ä¿®å¤å»ºè®®**: æ›¿æ¢ä¸º `<CheckCircle2>` / `<AlertCircle>` å›¾æ ‡ç»„ä»¶

### L-35 æ—¶é—´è¡¨ç‚¹æ— æ’åº/å»é‡æ ¡éªŒ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/components/ScheduleEditor/ScheduleEditor.tsx`
- **ç°è±¡**: å…è®¸æ·»åŠ é‡å¤æ—¶é—´ç‚¹æˆ–ä¹±åºæ—¶é—´ç‚¹ï¼Œå¼•æ“è¡Œä¸ºæœªå®šä¹‰
- **ä¿®å¤å»ºè®®**: æ·»åŠ æ—¶è‡ªåŠ¨æ’åºï¼Œæˆ–æ‹’ç»é‡å¤æ—¶é—´ç‚¹å¹¶æç¤º

### L-36 æ— è¿è¡Œæ—¶ JSON Schema æ ¡éªŒ ğŸŸ¢
- **æ–‡ä»¶**: `app/src/model/dataBridge.ts`, `schemas/topology.schema.json`
- **ç°è±¡**: `topology.schema.json` å­˜åœ¨ä½†å‰ç«¯ä»æœªå¼•ç”¨ã€‚å‘é€ç»™å¼•æ“çš„ JSON æœªç» schema éªŒè¯
- **ä¿®å¤å»ºè®®**: ä½¿ç”¨ `ajv` åœ¨å‘é€å‰éªŒè¯ï¼Œæˆ–è‡³å°‘åœ¨å¼€å‘æ¨¡å¼ä¸‹å¯ç”¨éªŒè¯

---

## å»ºè®®ä¼˜å…ˆä¿®å¤é¡ºåº

å…¨éƒ¨å·²ä¿®å¤ï¼Œä»…å‰© 1 é¡¹å¾…å®ç°ï¼š

1. **M-11** 6 ç§é«˜çº§å¼•æ“å…ƒä»¶æ—  canvas è¡¨ç¤º â€” SimpleGaseousFilterã€UVGIFilterã€SimpleParticleFilterã€SuperFilterã€QuadraticElementã€BackdraftDamper éœ€æ‰©å±• PlacementType æšä¸¾å¹¶æ·»åŠ  canvas å›¾æ ‡å’Œ dataBridge æ˜ å°„
