{
  "project": "CONTAM-Next Full Feature & UI Overhaul",
  "branchName": "ralph/full-overhaul",
  "description": "Complete Phase 7 (26 functional features) + Phase 8 (38 UI optimizations) to bring CONTAM-Next to production-grade quality",
  "userStories": [
    {
      "id": "US-001",
      "title": "shadcn/ui + Design Token Foundation",
      "description": "As a developer, I want a unified component library so that all UI elements are consistent and professional.",
      "acceptanceCriteria": [
        "shadcn/ui installed and configured with Tailwind v4",
        "Base components available: Button, Input, Select, Dialog, Tabs, Accordion, Toast, Tooltip, Slider, DropdownMenu, AlertDialog, Sheet",
        "Design tokens defined (spacing, radius, colors)",
        "Minimum font size 11px enforced",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false
    },
    {
      "id": "US-002",
      "title": "Layout Restructure with Resizable Panels",
      "description": "As a user, I want resizable panels so that I can customize my workspace layout.",
      "acceptanceCriteria": [
        "react-resizable-panels installed",
        "Main layout: left vertical toolbar | center canvas | right property panel (resizable)",
        "Bottom panel for results (collapsible, draggable height)",
        "Right panel has tab navigation (Properties / Contaminants / Schedules / Controls / Summary)",
        "Panel sizes saved to localStorage",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false
    },
    {
      "id": "US-003",
      "title": "Property Panel Tab System + Accordion Sections",
      "description": "As a user, I want organized property panels so that I can find settings quickly without endless scrolling.",
      "acceptanceCriteria": [
        "Right panel uses shadcn Tabs for major sections",
        "Each section uses Accordion for collapsible sub-panels",
        "ControlPanel state moved from useState to Zustand store",
        "Element type selector shows icons + descriptions",
        "Temperature K↔°C toggle with global preference",
        "Input validation with red border + error message",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false
    },
    {
      "id": "US-004",
      "title": "SketchPad Canvas Upgrade",
      "description": "As a user, I want a professional-grade canvas so that building modeling feels intuitive.",
      "acceptanceCriteria": [
        "Room nodes have resize handles (4 corners + 4 edges)",
        "Right-click context menu on nodes and links",
        "Multi-select with Shift+click and box selection",
        "Zoom controls (+/- buttons + slider + percentage display)",
        "Hover tooltip card showing node properties",
        "Building element SVG icons on link arrows (fan, duct, filter, etc.)",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false
    },
    {
      "id": "US-005",
      "title": "Canvas Advanced Features (Minimap + Ruler + Routing)",
      "description": "As a user working with large models, I want navigation aids and smart alignment.",
      "acceptanceCriteria": [
        "Minimap in bottom-right corner for models with >5 nodes",
        "Ruler along top and left edges",
        "Smart alignment guides when dragging (snap lines)",
        "Link routing: orthogonal/curved paths avoiding node overlap",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false
    },
    {
      "id": "US-006",
      "title": "Pollutant Templates + Source Icons on Canvas",
      "description": "As a user, I want quick-add common pollutants and see sources on the canvas.",
      "acceptanceCriteria": [
        "One-click templates for CO, CO2, HCHO, PM2.5, Radon with auto-filled properties",
        "Source/sink icons displayed on room nodes in SketchPad",
        "Wind pressure coefficient (Cp) field in node properties",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false
    },
    {
      "id": "US-007",
      "title": "ACH + Concentration Units + Safety Reference Lines",
      "description": "As an engineer, I want ACH values and proper concentration units so that I can assess compliance.",
      "acceptanceCriteria": [
        "ACH column in ResultsView node table",
        "Concentration unit toggle: kg/m³ ↔ ppm ↔ mg/m³ ↔ μg/m³",
        "Configurable safety reference lines on concentration charts",
        "Pressure difference comparison view (select 2 rooms)",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false
    },
    {
      "id": "US-008",
      "title": "Concentration Heatmap on Canvas",
      "description": "As a user, I want to see pollutant spread visually on the floor plan.",
      "acceptanceCriteria": [
        "Room fill color maps to concentration level (green→yellow→red gradient)",
        "Species selector dropdown for heatmap",
        "Time slider to scrub through transient results",
        "Color legend bar",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false
    },
    {
      "id": "US-009",
      "title": "Occupant System (Frontend + JSON)",
      "description": "As a user, I want to model building occupants so that I can assess exposure.",
      "acceptanceCriteria": [
        "OccupantPanel component with CRUD for occupants",
        "Movement schedule editor (time → zone assignments)",
        "Auto CO2 source injection for each occupant",
        "Occupants serialized in topology JSON",
        "Occupant data persisted in Zustand store",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false
    },
    {
      "id": "US-010",
      "title": "Exposure Report Panel",
      "description": "As a health researcher, I want exposure reports so that I can assess risk.",
      "acceptanceCriteria": [
        "ExposureReport component showing per-occupant cumulative dose, peak concentration, TWA",
        "Bar chart visualization per occupant per species",
        "Integrated as a tab in the results bottom panel",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false
    },
    {
      "id": "US-011",
      "title": "Data Export Enhancement",
      "description": "As a researcher, I want comprehensive data export for post-processing.",
      "acceptanceCriteria": [
        "Steady-state CSV export (node pressures + link flows + ACH)",
        "Full transient CSV with pressure, flow, concentration, ACH, exposure columns",
        "Tab-separated text export (.txt)",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false
    },
    {
      "id": "US-012",
      "title": "Schedule Binding to Airflow Elements + Gantt View",
      "description": "As a user, I want to schedule fan/damper/window operation over time.",
      "acceptanceCriteria": [
        "Schedule can be bound to Fan (on/off), Damper (fraction), Window (open/close)",
        "Link properties show schedule selector dropdown",
        "Gantt chart overview of all active schedules",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false
    },
    {
      "id": "US-013",
      "title": "HVAC System Editor (AHS)",
      "description": "As an HVAC engineer, I want to define air handling systems as logical units.",
      "acceptanceCriteria": [
        "AHS panel to group Fan+Duct+Filter+Supply/Return into a system",
        "SupplyDiffuser and ReturnGrille element types added",
        "Auto-wiring: select rooms → generate central HVAC topology",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false
    },
    {
      "id": "US-014",
      "title": "Multi-floor Building Support",
      "description": "As a user, I want to model multi-story buildings with stairwells and shafts.",
      "acceptanceCriteria": [
        "Level/floor management UI (add/remove/rename floors)",
        "Floor tab switching in SketchPad",
        "Shaft/stairwell nodes that span multiple floors",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": false
    },
    {
      "id": "US-015",
      "title": "Interaction Polish (Welcome, Dialogs, Toast, Shortcuts)",
      "description": "As a user, I want polished interaction patterns for a professional experience.",
      "acceptanceCriteria": [
        "Welcome page on empty canvas (quick start / open example / open file)",
        "Confirmation dialogs for destructive actions (clear all, delete node)",
        "Toast notifications for save/export/solve completion",
        "Keyboard shortcut overlay (? or Ctrl+/)",
        "Drag-drop .contam.json file import",
        "Recent files dropdown in toolbar",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false
    },
    {
      "id": "US-016",
      "title": "Results Panel Tabs + Table/Chart Enhancements",
      "description": "As a user, I want powerful result exploration tools.",
      "acceptanceCriteria": [
        "Bottom results panel uses Tabs: Steady-State / Transient / Exposure",
        "Table columns sortable, filterable, resizable",
        "Chart brush zoom on time axis",
        "Chart type toggle: line / area / bar",
        "Dual Y-axis mode (pressure + concentration)",
        "Full-screen chart mode",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": false
    },
    {
      "id": "US-017",
      "title": "Simulation Progress + Cancel + Parameter Sweep",
      "description": "As a user, I want real-time feedback and batch simulation capabilities.",
      "acceptanceCriteria": [
        "Real progress bar with percentage from engine IPC",
        "Cancel button to terminate running simulation",
        "Parameter sweep UI: select parameter, range, steps → run batch → compare results",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": false
    },
    {
      "id": "US-018",
      "title": "Dark Mode + Professional Theme + Transitions",
      "description": "As a user, I want a polished visual experience with theme options.",
      "acceptanceCriteria": [
        "Complete dark mode theme (all components, canvas, charts)",
        "System preference auto-detect + manual toggle",
        "Professional color scheme (CAD-inspired neutral tones)",
        "Smooth CSS transitions on panel changes (150-300ms)",
        "Inter font + Chinese fallback chain",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": false
    },
    {
      "id": "US-019",
      "title": "Performance + Accessibility + HDF5 Frontend",
      "description": "As a user, I want the app to be fast and accessible.",
      "acceptanceCriteria": [
        "Konva cacheNode for >50 nodes",
        "Virtual scroll for long lists (react-virtual)",
        "ARIA labels on all interactive elements",
        "Keyboard navigation (Tab + Enter)",
        "Loading skeleton during simulation",
        "HDF5 result loading in frontend",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": false
    }
  ]
}
